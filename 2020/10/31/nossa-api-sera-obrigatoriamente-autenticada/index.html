<!doctype html>
<html lang="pt">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Nossa API será obrigatoriamente autenticada | Brasil.IO - Blog
</title>
  <link rel="canonical" href="https://blog.brasil.io/2020/10/31/nossa-api-sera-obrigatoriamente-autenticada/index.html">


  <link rel="stylesheet" href="https://blog.brasil.io/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://blog.brasil.io/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://blog.brasil.io/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://blog.brasil.io/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://blog.brasil.io/feeds/all.atom.xml">
  <link rel="alternate" type="application/rss+xml" title="Full RSS Feed"
        href="https://blog.brasil.io/feed.rss">  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://blog.brasil.io/feeds/meta.atom.xml">  
  <meta name="description" content="A partir do dia 9 de novembro de 2020 nossa API só aceitará requisições autenticadas. Entenda como acessá-la a partir dessa data e porque precisamos fazer essa alteração.">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-117698282-2', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <div class="col-sm-12">
      <a href="https://blog.brasil.io/">
        <img class="img-fluid rounded" src=https://blog.brasil.io/theme/images/logo-blog.brasil.io.png alt="Brasil.IO - Blog">
      </a>
    </div>

    <div class="row">
      <div class="col-sm-9">
        <ul class="list-inline">
            <li class="list-inline-item"><a href="https://blog.brasil.io/" target="_blank">Blog</a></li>
            <li class="list-inline-item"><a href="https://brasil.io/datasets" target="_blank">Datasets</a></li>
            <li class="list-inline-item"><a href="https://brasil.io/colabore" target="_blank">Colabore</a></li>
            <li class="list-inline-item"><a href="https://brasil.io/contato" target="_blank">Contato</a></li>
        </ul>
      </div>
      <div class="col-sm-3 text-right">
        <a href="https://blog.brasil.io/feed.rss"><i class="fa fa-rss"></i></a>
        <a href="https://github.com/turicas/blog.brasil.io"><i class="fa fa-github"></i></a>
      </div>
    </div>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Nossa <span class="caps">API</span> será obrigatoriamente&nbsp;autenticada
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2020-10-31T16:30:00-03:00">
          <i class="fa fa-clock-o"></i>
          sáb 31 outubro 2020
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="https://blog.brasil.io/category/meta.html">meta</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-user-o"></i>
              <a href="https://blog.brasil.io/author/alvaro-justen.html">Álvaro Justen</a>          </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="https://blog.brasil.io/tag/api.html">#api</a>,               <a href="https://blog.brasil.io/tag/infraestrutura.html">#infraestrutura</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>A partir do dia <strong>9 de novembro de 2020</strong> nossa <span class="caps">API</span> aceitará <strong>somente
requisições autenticadas</strong>. Entenda como acessá-la a partir dessa data e porque
precisamos fazer essa&nbsp;alteração:</p>
<ul>
<li><a href="#como-acessar-a-api-autenticada">Como acessar a <span class="caps">API</span>&nbsp;autenticada</a></li>
<li><a href="#entendendo-o-problema">Entendendo o&nbsp;Problema</a></li>
<li><a href="#licoes-aprendidas">Lições&nbsp;Aprendidas</a></li>
<li><a href="#como-voce-pode-ajudar">Como Você Pode&nbsp;Ajudar</a></li>
</ul>
<h3 id="como-acessar-a-api-autenticada"><a class="toclink" href="#como-acessar-a-api-autenticada">Como acessar a <span class="caps">API</span>&nbsp;autenticada</a></h3>
<p>Em resumo: você precisará criar cadastro na plataforma, criar um <em>token</em> e
enviá-lo no cabeçalho <span class="caps">HTTP</span> <code>Authorization</code>. Vamos ao&nbsp;passo-a-passo:</p>
<ul>
<li>Caso você não possua um cadastro na plataforma,
  <strong><a href="https://brasil.io/auth/entrar/">cadastre-se</a> e confirme seu email</strong>;</li>
<li><a href="https://brasil.io/auth/login/"><strong>Autentique-se</strong> na plataforma</a>;</li>
<li>Acesse a página <a href="https://brasil.io/auth/tokens-api/">de <strong>criação de <em><span class="caps">API</span>
  tokens</em></strong></a>, crie um e guarde-o em local&nbsp;seguro;</li>
<li>Ao criar programas que acessem a <span class="caps">API</span> do Brasil.<span class="caps">IO</span>, utilize apenas o <em>host</em>
  <code>api.brasil.io</code> (em vez do antigo <code>brasil.io/api</code>) e envie o <strong>cabeçalho <span class="caps">HTTP</span>
  <code>Authentication</code> com o valor <code>Token &lt;seu-token&gt;</code></strong>. Veja um exemplo em
  Python: <a href="https://gist.github.com/turicas/3e3621d61415e3453cd03a1997f7473f#file-brasil_io-py"><code>brasil_io.py</code></a> (em breve essa biblioteca estará
  disponível no <a href="https://pypi.org/">Python Package Index</a>).</li>
</ul>
<p>Você já pode alterar seus programas <strong>agora</strong> e testá-los na <span class="caps">API</span> e, caso as
requisições sejam feitas com sucesso utilizando a autenticação, você não
precisará fazer alterações em seus programas no dia 9 de novembro. Caso tenha
problemas, <a href="https://brasil.io/contato/">entre em contato conosco</a>.</p>
<blockquote>
<p><strong><span class="caps">IMPORTANTE</span></strong>: caso você precise acessar uma quantidade muito grande de
dados, é provável que seja mais eficiente baixar os datasets completos. Para
entender como fazer isso e detalhes de como acessar os dados através da <span class="caps">API</span>,
veja nosso artigo <a href="/2020/10/10/como-acessar-os-dados-do-brasil-io/">Como acessar os dados do
Brasil.<span class="caps">IO</span></a>.</p>
</blockquote>
<h3 id="entendendo-o-problema"><a class="toclink" href="#entendendo-o-problema">Entendendo o&nbsp;Problema</a></h3>
<p>Apesar de existir como é hoje desde 2018, o <a href="https://brasil.io/">Brasil.<span class="caps">IO</span></a> ganhou muita
visibilidade após lançarmos o <a href="https://brasil.io/dataset/covid19/">dataset <span class="caps">COVID</span>-19</a> em março de
2020, o que mostra a <strong>carência por dados abertos acessíveis sobre a pandemia</strong>
e a <strong>importância de nosso trabalho</strong>. Desde março, além de diversas demandas
para sanar dúvidas sobre os dados e entrevistas sobre os apagões de dados,
precisamos fazer (e fizemos) várias otimizações no código do nosso <em>backend</em>
para que a <span class="caps">API</span> funcionasse mais rapidamente e conseguisse atender a todos;
essas alterações (como implementação de um sistema de cache mais robusto) nos
tomaram tempo, mas foram necessárias devido ao novo tamanho e às novas
responsabilidades que o projeto&nbsp;assumiu.</p>
<p>Apesar de pequenas lentidões pontuais, conseguimos contornar o problema da
quantidade de acessos, até que durante dias recebemos uma <strong>quantidade enorme
de requisições complexas</strong> (com muitos filtros, custosas aos nossos servidores)
aos <a href="https://brasil.io/dataset/govbr/auxilio_emergencial/">dados do auxílio emergencial</a>, desproporcional com o
tamanho da plataforma (mesmo depois do recente crescimento). Essas requisições
impactaram negativamente a experiência de quem acessa o site, deixando-o mais
lento que o normal e impossibilitou, inclusive, que diversas <a href="https://brasil.io/covid19/voluntarios/">pessoas
voluntárias</a> pudessem subir os dados da
<span class="caps">COVID</span>-19, que são atualizados várias vezes por dia e utilizados por diversas
instituições no acompanhamento da pandemia no&nbsp;Brasil.</p>
<p>Sempre acreditei que <strong>a <span class="caps">API</span> do Brasil.<span class="caps">IO</span> deveria ser aberta</strong> (sem
autenticação), para facilitar o uso dos dados, por exemplo na criação de
aplicações Web <em>front-end</em> que não necessitem de um <em>backend</em> próprio. Isso
potencializa o controle social, como mostrei <a href="https://www.youtube.com/watch?v=EbbSx41BGRw">em uma palestra em 2014 durante o
Fórum Internacional de Software Livre</a>, antes mesmo do
<a href="https://brasil.io/">Brasil.<span class="caps">IO</span></a> existir como é&nbsp;hoje.</p>
<p>Porém, a partir do momento em que essas requisições impedem que outros usuários
acessem o site e que consigamos fazer a atualização devida, precisamos tomar
alguma atitude. Emergencialmente, implementamos limites à quantidade de acessos
por <span class="caps">IP</span> por minuto e bloqueios para os IPs que excederem várias vezes os limites
(bloqueando diretamente na <a href="https://www.cloudflare.com/">CloudFlare</a>, a <a href="https://pt.wikipedia.org/wiki/Rede_de_fornecimento_de_conte%C3%BAdo">rede de distribuição de
conteúdo</a> que utilizamos, e baixando a pressão sobre nossos servidores).
Também precisei entrar em contato diretamente com alguns provedores, reportando
o abuso vindo de alguns IPs (nem todos&nbsp;responderam).</p>
<p>Com os limites e bloqueios a plataforma se estabilizou, mas sabemos que essa
não é a melhor alternativa a longo prazo. Queremos aumentar os limites e
gostaríamos de ter contato mais próximo com quem usa a <span class="caps">API</span> (pelo fato de não
conseguirmos identificar as pessoas que fizeram essas requisições, tivemos
dificuldade não somente em comunicar melhores práticas de acesso aos dados,
como também de bloquear mais facilmente esses usos abusivos). Por isso,
decidmos que todo acesso à <span class="caps">API</span> será autenticado e, para isso, melhoramos nosso
cadastro, adicionando <em>captcha</em> e confirmação por e-mail. A partir do cadastro
mais robusto conseguiremos não somente controlar os acessos (e bloqueá-los, se
necessário), mas também contatar os responsáveis por eventuais&nbsp;abusos.</p>
<p>Se você quiser saber mais detalhes técnicos por trás dessa decisão, acesse as
<em>issues</em> <a href="https://github.com/turicas/brasil.io/issues/392">392</a>, <a href="https://github.com/turicas/brasil.io/issues/426">426</a>, <a href="https://github.com/turicas/brasil.io/issues/427">427</a>, <a href="https://github.com/turicas/brasil.io/issues/438">438</a>
e <a href="https://github.com/turicas/brasil.io/issues/474">474</a>. Também estamos trabalhando na melhoria da <span class="caps">API</span> na <a href="https://github.com/turicas/brasil.io/issues/488"><em>issue</em>
488</a>.</p>
<h4 id="ataques-ou-uso-massivo"><a class="toclink" href="#ataques-ou-uso-massivo">Ataques ou uso&nbsp;massivo?</a></h4>
<p>É possível (apesar de eu achar improvável) que a(s) pessoa(s) que fez(fizeram)
todas essas requisições nocivas não tenham feito com o intuito de atacar a
plataforma, mas de fato o resultado foi prejudicial a todos os usuários. Seria
muito mais fácil e eficiente tecnicamente se a pessoa simplesmente baixasse o
<em>dataset</em>&nbsp;completo.</p>
<p>As características do ataque me levam a crer que tenha sido um DDoS
(<em>distributed denial of service</em>), pelo fato de serem muitas requisições de IPs
completamente diferentes e mirando apenas um <em>dataset</em>, com filtros muito
parecidos. Além disso, na mesma época em que sofremos esses ataques, o <a href="http://transparencia.gov.br/">Portal
da Transparência do Governo Federal</a> também recebeu
muitas requisições (tornando seu uso bastante lento) para o mesmo <em>dataset</em> e
cheguei a receber um email de alguém supostamente da Polícia Federal, exigindo
que eu retirasse do ar esses dados pois estavam sendo usados por criminosos (o
que não faz sentido, dado que os dados são públicos e temos total respeito com
a privacidade das pessoas descritas nesse <em>dataset</em>, não informando dados
sensíveis como <span class="caps">CPF</span>, mesmo que a fonte oficial divulgue essas&nbsp;informações).</p>
<p>Se você não sabe o que é um ataque DDoS, imagine uma pizzaria que recebe 50
pedidos por dia em média e, num determinado dia, passa a receber ligações de
diversas pessoas a partir de telefones que nunca antes ligaram, fazendo um
total de 500 pedidos, passando endereços falsos. Imagine o caos na cozinha
dessa pizzaria nesse dia e a quantidade de clientes fiés que não terão suas
pizzas em casa no tempo previso. Em outras palavras, num ataque de negação de
serviço o atacante estressa o sistema com requisições inválidas, para que o
sistema não consiga atender aos clientes reais. Vale notar que no caso do
Brasil.<span class="caps">IO</span> os &#8220;clientes&#8221; <strong>não pagam</strong> pelo serviço e os &#8220;cozinheiros&#8221; são
voluntários que doam seu tempo com o objetivo de disponibilizar dados
brasileiros mais&nbsp;acessíveis.</p>
<h3 id="licoes-aprendidas"><a class="toclink" href="#licoes-aprendidas">Lições&nbsp;Aprendidas</a></h3>
<ul>
<li><strong>Não podemos contar com o bom senso das pessoas para questões que podem
  impactar negativamente o projeto</strong>: infelizmente, muitas vezes pessoas agem
  sem empatia e foi exatamente o que aconteceu nesse caso. Algumas
  (possivelmente poucas) pessoas abusaram da <span class="caps">API</span> e fizeram com que muitas
  outras pessoas fossem prejudicadas (nesse caso, desabilitamos a <span class="caps">API</span> para esse
  <em>dataset</em> e não prosseguimos com a atualização de dados que estava
  programada). Em casos como esses precisamos assumir uma <strong>postura
  defensiva</strong>.</li>
<li><strong>Precisamos investir mais tempo em educar usuários</strong>: tempo não investido em
  mostrar aos usuários da plataforma como utilizá-la da melhor forma é
  revertido em tempo gasto na mitigação dos problemas causados por isso e, com
  isso, teremos menos para evoluir a plataforma, adicionando funcionalidades e
  <em>datasets</em>. Nesse ponto, precisamos melhorar a documentação de uso e
  contribuição com a plataforma (esse caminho já está sendo&nbsp;trilhado).</li>
<li><strong>Precisamos nos aproximar mais dos usuários</strong>: fica evidente a necessidade
  de estarmos em contato mais próximo com quem utiliza nossos dados e a
  plataforma (esse foi um dos motivos de obrigatoriedade da <span class="caps">API</span>: assim
  conseguimos identificar cada um e, caso necessário, entrar em contato). Para
  ajudar a resolver isso, criamos um <a href="https://t.me/brasil_io">canal no Telegram</a>,
  reativamos nossa <a href="https://twitter.com/brasil_io">conta no Twitter</a> e me comprometo a
  publicar relatórios mensais (<a href="/2020/10/01/relatorio-mensal-setembro-de-2020/">como o de setembro de
  2020</a>).</li>
</ul>
<h3 id="como-voce-pode-ajudar"><a class="toclink" href="#como-voce-pode-ajudar">Como Você Pode&nbsp;Ajudar</a></h3>
<p>Ainda temos muito trabalho a fazer e, se você quiser nos ajudar nesse jornada
de <strong>tornar acessíveis os dados públicos brasileiros</strong>, considere <a href="https://apoia.se/brasilio">doar em
nossa campanha de financiamento coletivo</a> ou se unir às
<a href="https://brasil.io/covid19/voluntarios/">pessoas voluntárias do projeto <span class="caps">COVID</span>-19</a>
através do <a href="https://chat.brasil.io/">nosso chat</a>.</p>
    </div>
  </article>
  <hr>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function() {
      this.page.url = 'https://blog.brasil.io/2020/10/31/nossa-api-sera-obrigatoriamente-autenticada/index.html';
      this.page.identifier = 'nossa-api-sera-obrigatoriamente-autenticada';
    };
    (function() {
      var d = document;
      var s = d.createElement('script');
      s.src = '//brasilio.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript class="text-muted">
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="https://blog.brasil.io/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="https://blog.brasil.io/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://blog.brasil.io/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://blog.brasil.io/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>
</body>

</html>